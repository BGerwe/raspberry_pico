function setJumpShopTracking(t, e) { const o = new Date; o.setTime(o.getTime() + 24 * e * 60 * 60 * 1e3); let i = "expires=" + o.toUTCString(); document.cookie = "__jumpMyShopTracking=" + t + ";" + i + ";path=/" } function setJumpDiscountCodeTracking(t) { document.cookie = "discount_code=" + t + ";expires=0;path=/" } function getCookieUniversal(t) { const e = document.cookie.split("; "); for (const o of e) { const [e, i] = o.split("="); if (e === t) return i } return null } function getShopifyShop() { const t = document.getElementsByTagName("script"), e = Array.from(t).find((t => t.innerText.includes("var Shopify"))); if (!e) return void goBack(); let o = e.innerText; o = o.replace("var Shopify = Shopify || {};\n", ""); const i = o.split("Shopify.").find((t => t.includes("shop ="))); if (!i) return void goBack(); let n = i.split("shop =")[1].split(";")[0].replace(/\"/g, "").trim(); return n = n.split(".")[0], n.replace(/-/g, "").trim() } function validateDiscountCodeForTracking() { const t = getCookieUniversal("__jumpMyShopTracking"); if (!t) return ""; let e = {}; try { e = JSON.parse(t) } catch (t) { return console.error("Error parsing cookie object string:", t), "" } if (e.discountCode) { const t = e.discountCode; return setJumpDiscountCodeTracking(t), t } const o = getCookieUniversal("discount_code"); return o || "" } function getShopifyShopExtra() { const t = document.getElementsByTagName("script"), e = Array.from(t).find((t => t.innerText.includes("var Shopify"))); if (!e) return null; let o = e.innerText; o = o.replace("var Shopify = Shopify || {};\n", ""); const i = o.split("Shopify.").find((t => t.includes("shop ="))); if (!i) return null; let n = i.split("shop =")[1].split(";")[0].replace(/\"/g, "").trim(); return n = n.split(".")[0], n.replace(/-/g, "").trim() } async function GetIPJump() { return await fetch("https://www.cloudflare.com/cdn-cgi/trace", { method: "GET" }).then((t => t.text())).then((t => { const e = t.match(/ip=(.*)/); return e ? e[1].toString() : "Not informed" })).catch((() => "Not informed")) } async function saveVisit(t) { const e = getShopifyShopExtra(); if (!e) return; const o = new Headers; o.append("x-server-origin", "app.myjshops.com"), o.append("x-ip-origin", await GetIPJump()), o.append("client-access-key", e); t && fetch(`https://api-base.myjshops.com/api/Platform/SaveDomainVisit/${t}`, { method: "GET", headers: o, redirect: "follow", mode: "cors" }) } function getMyshopTracking() { if (window.location.pathname.includes("my-shop")) return; let t = getCookieUniversal("__jumpMyShopTracking"), e = {}; if (t) try { e = JSON.parse(t) } catch (t) { e = { storefront: "", storeShop: getShopifyShop(), discountCode: "" } } let o = validateDiscountCodeForTracking(); const i = new URL(document.location).searchParams.get("_j"); if (i) { const t = { storefront: i, storeShop: getShopifyShop(), discountCode: o ?? "" }; setJumpShopTracking(JSON.stringify(t), 30), saveVisit(i) } else t && e.storefront && (t = JSON.stringify(e), setJumpShopTracking(t, 30), saveVisit(e.storefront)) } window.onload = getMyshopTracking();
